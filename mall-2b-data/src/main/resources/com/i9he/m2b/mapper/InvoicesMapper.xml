<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.i9he.m2b.mapper.InvoicesMapper" >
  <resultMap id="BaseResultMap" type="com.i9he.m2b.model.Invoices" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      copyright@ www.9he.com
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="type" property="type" jdbcType="INTEGER" />
    <result column="state" property="state" jdbcType="INTEGER" />
    <result column="user_id" property="userId" jdbcType="INTEGER" />
    <result column="order_id" property="orderId" jdbcType="INTEGER" />
    <result column="organization" property="organization" jdbcType="VARCHAR" />
    <result column="user_idcode" property="userIdcode" jdbcType="VARCHAR" />
    <result column="regist_address" property="registAddress" jdbcType="VARCHAR" />
    <result column="regist_phone" property="registPhone" jdbcType="VARCHAR" />
    <result column="bank" property="bank" jdbcType="VARCHAR" />
    <result column="bank_account" property="bankAccount" jdbcType="VARCHAR" />
    <result column="header" property="header" jdbcType="VARCHAR" />
    <result column="content" property="content" jdbcType="VARCHAR" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="username" property="userName" jdbcType="VARCHAR" />
    <result column="created_time" property="createdTime" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      copyright@ www.9he.com
    -->
    i.id, i.type, i.state,user_id, order_id, organization, user_idcode, regist_address, regist_phone, 
    bank, bank_account, `header`, content, remark, created_time
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      copyright@ www.9he.com
    -->
    select 
    <include refid="Base_Column_List" />
    from b2b_invoice as i
    where id = #{id,jdbcType=INTEGER}
  </select>
  <insert id="insert" parameterType="com.i9he.m2b.model.Invoices" useGeneratedKeys="true" keyProperty="id" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      copyright@ www.9he.com
    -->
    insert into b2b_invoice (`type`,state, user_id, order_id, 
      organization, user_idcode, regist_address, 
      regist_phone, bank, bank_account, 
      `header`, content, remark, 
      created_time)
    values (#{type,jdbcType=INTEGER},#{state,jdbcType=INTEGER}, #{userId,jdbcType=INTEGER}, #{orderId,jdbcType=INTEGER}, 
      #{organization,jdbcType=VARCHAR}, #{userIdcode,jdbcType=VARCHAR}, #{registAddress,jdbcType=VARCHAR}, 
      #{registPhone,jdbcType=VARCHAR}, #{bank,jdbcType=VARCHAR}, #{bankAccount,jdbcType=VARCHAR}, 
      #{header,jdbcType=VARCHAR}, #{content,jdbcType=VARCHAR}, #{remark,jdbcType=VARCHAR}, 
      #{createdTime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.i9he.m2b.model.Invoices" useGeneratedKeys="true" keyProperty="id" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      copyright@ www.9he.com
    -->
    insert into b2b_invoice
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="type != null" >
        `type`,
      </if>
      <if test="state != null" >
        state,
      </if>
      <if test="userId != null" >
        user_id,
      </if>
      <if test="orderId != null" >
        order_id,
      </if>
      <if test="organization != null" >
        organization,
      </if>
      <if test="userIdcode != null" >
        user_idcode,
      </if>
      <if test="registAddress != null" >
        regist_address,
      </if>
      <if test="registPhone != null" >
        regist_phone,
      </if>
      <if test="bank != null" >
        bank,
      </if>
      <if test="bankAccount != null" >
        bank_account,
      </if>
      <if test="header != null" >
        `header`,
      </if>
      <if test="content != null" >
        content,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="createdTime != null" >
        created_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="type != null" >
        #{type,jdbcType=INTEGER},
      </if>
      <if test="state != null" >
        #{state,jdbcType=INTEGER},
      </if>
      <if test="userId != null" >
        #{userId,jdbcType=INTEGER},
      </if>
      <if test="orderId != null" >
        #{orderId,jdbcType=INTEGER},
      </if>
      <if test="organization != null" >
        #{organization,jdbcType=VARCHAR},
      </if>
      <if test="userIdcode != null" >
        #{userIdcode,jdbcType=VARCHAR},
      </if>
      <if test="registAddress != null" >
        #{registAddress,jdbcType=VARCHAR},
      </if>
      <if test="registPhone != null" >
        #{registPhone,jdbcType=VARCHAR},
      </if>
      <if test="bank != null" >
        #{bank,jdbcType=VARCHAR},
      </if>
      <if test="bankAccount != null" >
        #{bankAccount,jdbcType=VARCHAR},
      </if>
      <if test="header != null" >
        #{header,jdbcType=VARCHAR},
      </if>
      <if test="content != null" >
        #{content,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createdTime != null" >
        #{createdTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <sql id="whereForSearchModel">
  	<where>
  		is_del = 0
  		<if test="type != null">
  			and i.type = #{type}
  		</if>
  		<if test="state != null">
  			and i.state = #{state}
  		</if>
  		<if test="userId != null">
  			and i.user_id = #{userId}
  		</if>
  		<trim prefix="AND(" prefixOverrides="AND|OR" suffix=")">
  			<if test="keyword != null">
	    		AND CONCAT_WS(',', order_id, remark) like concat('%', #{keyword}, '%')
	    	</if>
	    	<if test="userList != null and userList.size() != 0">
	    		OR user_id in <foreach close=")" collection="userList" item="item" open="(" separator=",">#{item}</foreach>
	    	</if>
    	</trim>
  	</where>
  </sql>
  
  <select id="selectBySearchModel" parameterType="com.i9he.m2b.model.search.InvoiceSearchModel" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />,username
    from b2b_invoice as i
    left join usr_user as u on i.user_id = u.id
    <include refid="whereForSearchModel" />
    order by created_time desc
  </select>
  <select id="selectCountBySearchModel" parameterType="com.i9he.m2b.model.search.InvoiceSearchModel" resultType="int">
    select count(1) from b2b_invoice as i
    <include refid="whereForSearchModel" />
  </select>
  
  <select id="selectByUserId" parameterType="com.i9he.m2b.model.search.InvoiceSearchModel" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from b2b_invoice as i
    where is_del = 0 and user_id = #{userId,jdbcType=INTEGER}
    order by created_time desc
    limit #{offset}, #{pageSize}
  </select>
  <select id="selectCountByUserId" parameterType="com.i9he.m2b.model.search.InvoiceSearchModel" resultType="int">
    select count(1) from b2b_invoice as i
    where is_del = 0 and user_id = #{userId,jdbcType=INTEGER}
  </select>
  
  <update id="updateByPrimaryKeySelective" parameterType="com.i9he.m2b.model.Invoices" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      copyright@ www.9he.com
    -->
    update b2b_invoice
    <set >
      <if test="type != null" >
        `type` = #{type,jdbcType=INTEGER},
      </if>
      <if test="state != null" >
        state = #{state,jdbcType=INTEGER},
      </if>
      <if test="userId != null" >
        user_id = #{userId,jdbcType=INTEGER},
      </if>
      <if test="orderId != null" >
        order_id = #{orderId,jdbcType=INTEGER},
      </if>
      <if test="organization != null" >
        organization = #{organization,jdbcType=VARCHAR},
      </if>
      <if test="userIdcode != null" >
        user_idcode = #{userIdcode,jdbcType=VARCHAR},
      </if>
      <if test="registAddress != null" >
        regist_address = #{registAddress,jdbcType=VARCHAR},
      </if>
      <if test="registPhone != null" >
        regist_phone = #{registPhone,jdbcType=VARCHAR},
      </if>
      <if test="bank != null" >
        bank = #{bank,jdbcType=VARCHAR},
      </if>
      <if test="bankAccount != null" >
        bank_account = #{bankAccount,jdbcType=VARCHAR},
      </if>
      <if test="header != null" >
        `header` = #{header,jdbcType=VARCHAR},
      </if>
      <if test="content != null" >
        content = #{content,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createdTime != null" >
        created_time = #{createdTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.i9he.m2b.model.Invoices" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      copyright@ www.9he.com
    -->
    update b2b_invoice
    set `type` = #{type,jdbcType=INTEGER},
      state = #{state,jdbcType=INTEGER},
      user_id = #{userId,jdbcType=INTEGER},
      order_id = #{orderId,jdbcType=INTEGER},
      organization = #{organization,jdbcType=VARCHAR},
      user_idcode = #{userIdcode,jdbcType=VARCHAR},
      regist_address = #{registAddress,jdbcType=VARCHAR},
      regist_phone = #{registPhone,jdbcType=VARCHAR},
      bank = #{bank,jdbcType=VARCHAR},
      bank_account = #{bankAccount,jdbcType=VARCHAR},
      `header` = #{header,jdbcType=VARCHAR},
      content = #{content,jdbcType=VARCHAR},
      remark = #{remark,jdbcType=VARCHAR},
      created_time = #{createdTime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <select id="selectByOrderId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
  	select 
  	<include refid="Base_Column_List"/>
  	from b2b_invoice as i
  	where order_id = #{orderId,jdbcType=INTEGER}
  </select>
</mapper>